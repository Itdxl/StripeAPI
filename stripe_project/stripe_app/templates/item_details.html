<html>
  <head>
    <title>Buy Item {{item.id}}</title>
  </head>
  <body>
    <h1>Item number {{item.id}} </h1>
    <p>Description:</p>
    <p>{{ item.description }}</p>
    <p>Price:</p>
    <p>{{ item.price }}</p>
    <button id="buy-button">Buy</button>
    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript">
        var stripe = Stripe('{{ public_stripe_key }}');
        var buyButton = document.getElementById('buy-button');
        var itemId = window.location.pathname.split('/').pop();
        console.log('Item ID:', itemId); // Проверяем значение itemId
        buyButton.addEventListener('click', function() {
            console.log('Button clicked'); // Проверяем, срабатывает ли обработчик события клика на кнопке "Buy"
            // Create a new Checkout Session using the server-side endpoint 
            // Redirect to Stripe Session Checkout
            fetch('{% url "buy-item" item.id %}', { method: 'GET' })
            .then(response => response.json())
            .then(session => {
                console.log(session);
                stripe.redirectToCheckout({ sessionId: session.session_id });
              })
            .catch(error => console.error('Error:', error)); // Добавляем обработку ошибок
        });
        
    </script>
  </body>
</html>
